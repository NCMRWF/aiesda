# AIESDA Configuration
cost function:
  background:
    filename: ncmrwf_anemoi_bg.nc  # From your Python script
    state variables: [air_temperature]
  
  observations:
  - obs space:
      obsfile: aiesda_obs_sfc.nc    # From your IODA conversion
    obs operator:
      name: VertInterp

background error:
  covariance model: SABER
  saber central block:
    saber block name: BUMP_NICAS
    # --- Monsoon Tuning ---
    calibration:
      io:
        data directory: ./bump_stats
        files prefix: aiesda_monsoon_v1
      drivers:
        multivariate strategy: univariate
        compute nicas: true
        # Define the 'reach' of a single observation
        forced radii: true
        rh:
          air_temperature: [250.0e3] # 250 km radius for India
      nicas:
        resolution: 6
        explicit length-scales: true
  
  saber outer blocks:
  - saber block name: StdDev
    read:
      # Use the error stats generated by your Python script (Step 9)
      model fields:
      - variable: air_temperature
        field: air_temperature
      dataset: anemoi_error_stats.nc      # From the xarray calculation 

obs space:
  name: Surface_Obs
  obsfile: aiesda_obs_sfc.nc
  simulated variables: [air_temperature]  # Matches your ('air_temperature', 'ObsValue')

obs operator:
  name: VertInterp
  vertical coordinate: height            # Assumes your Anemoi NetCDF has 'height'
  observation vertical coordinate: height # Assumes your IODA MetaData has 'height'

obs filters:
- filter: Background Check
  filter variables: [air_temperature]
  threshold: 3.0   # Reject if |Obs - Anemoi| > 3.0 Kelvin
  action:
    name: reject

- filter: Domain Check
  where:
  - variable: {name: MetaData/latitude}
    min: 5.0
    max: 38.0
  - variable: {name: MetaData/longitude}
    min: 65.0
    max: 98.0
